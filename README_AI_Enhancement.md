# PubMed文献信息提取增强功能

## 功能概述

本增强功能为 `pubmed.py` 脚本添加了AI驱动的信息提取能力，能够从科学文献摘要中自动提取以下关键信息：

- **研究对象** - 研究参与者的人群特征
- **样本量** - 研究中使用的样本数量
- **推荐补充剂量/用法** - 建议的补充剂使用方法和剂量
- **作用机理** - 产品或治疗方法的作用机制

## 混合提取策略

采用"正则表达式为主，AI API为辅"的混合提取方法：

1. **正则表达式提取** - 优先使用预定义的正则表达式模式提取信息
2. **质量评估** - 评估提取结果的质量（有效字段数量）
3. **AI补充** - 当正则提取质量较低时（有效字段<2），使用AI API进行补充
4. **结果合并** - AI结果优先，缺失字段使用正则提取结果

## 使用方法

### 测试模式
```bash
python pubmed.py test
```
测试混合提取功能，使用内置的测试摘要验证功能。

### 正常bash
python pub搜索模式
```med.py [关键词]
```
搜索PubMed数据库并应用增强的信息提取功能。

## API配置

### API密钥
- 当前配置使用：`sk-1wLZqqkXDT9shZzgTqNRc0wNB6K4Kmu1t0kov0KA5I3auqVf`

### 支持的模型
- `gpt-4` - 基础GPT-4模型
- `gpt-3.5-turbo` - 快速GPT-3.5模型
- `claude-3` - Claude-3模型

### API端点
- 主端点：`https://api.gptgod.online/v1/chat/completions`
- 网络搜索：使用 `net-` 前缀启用网络搜索功能

## 核心函数

### `extract_info_with_regex(abstract_text)`
使用正则表达式提取信息的主要函数：
- 样本量提取：识别数字、范围、人数
- 研究对象提取：年龄、性别、体重、BMI等
- 剂量用法提取：数字+单位组合
- 作用机理提取：机制相关关键词

### `extract_info_with_ai(abstract_text)`
使用AI API进行信息提取：
- 多模型尝试机制
- 自动重试和错误处理
- 频率限制保护

### `validate_extracted_data(data)`
验证提取数据的完整性：
- 字段非空检查
- 数据类型验证
- 格式规范化

## 错误处理

### API限制
- 403错误：API密钥模型限制 → 切换备用模型
- 429错误：频率限制 → 自动重试机制
- 网络错误 → 备用数据提供

### 降级机制
- 正则提取失败 → 提供默认占位符
- AI提取失败 → 使用正则结果或默认占位符
- 数据验证失败 → 标记为"需人工确认"

## 测试结果示例

测试摘要1：成功提取4/4字段
```
研究对象: 25、55、overweight、overweight、overweight、men、men、men、men、BMI 25-30
样本量: 60
推荐补充剂量/用法: 30ml MCT oil daily
作用机理: increase thermogenesis；promote fat oxidation
```

测试摘要2：成功提取3/4字段
```
研究对象: men
样本量: 512
推荐补充剂量/用法: 未明确说明
作用机理: increase energy expenditure；enhance satiety；promote ketogenesis
```

测试摘要3：成功提取4/4字段
```
研究对象: men、women
样本量: 80
推荐补充剂量/用法: 20g MCT daily
作用机理: stimulate uncoupling proteins
```

## 配置参数

### 正则表达式阈值
- 高质量阈值：≥2个有效字段 → 直接使用正则结果
- 触发AI阈值：<2个有效字段 → 启用AI补充

### API重试机制
- 最大重试次数：3次
- 重试间隔：1秒
- 失败回退：备用模型

## 日志和监控

- 详细提取过程日志
- API调用状态记录
- 错误和异常追踪
- 性能统计信息

## 注意事项

1. **API成本**：AI提取会产生API调用费用，建议监控使用量
2. **隐私保护**：确保摘要文本不包含敏感信息
3. **结果验证**：所有提取结果建议人工验证
4. **模型限制**：API密钥可能有特定模型限制

## 故障排除

### 常见问题

1. **API 403错误**：检查API密钥和模型权限
2. **API 429错误**：降低请求频率，增加重试间隔
3. **提取质量低**：调整正则表达式模式或降低AI触发阈值
4. **网络连接问题**：检查网络连接和API端点可用性

### 调试模式

启用详细日志：
```python
logging.basicConfig(level=logging.DEBUG)
```

## 更新日志

- **v2.0** - 实现混合提取策略，优化API错误处理
- **v1.0** - 基础正则表达式提取功能

## 技术支持

如有问题，请检查：
1. API密钥配置
2. 网络连接状态
3. 日志文件中的错误信息
4. 测试用例验证结果